{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إتمام الدفع</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#16a34a'
                    },
                    fontFamily: {
                        cairo: ['Cairo', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Cairo', sans-serif; }
    </style>
</head>

<body class="bg-gray-100 min-h-screen pb-32">

<!-- ================= HEADER ================= -->
{% include "header.html" %}

<div class="h-24"></div>

<!-- ================= TITLE ================= -->
<h2 class="text-2xl font-extrabold text-center text-gray-800">
    إتمام عملية الدفع
</h2>

<!-- ================= ADDRESS ================= -->
<div class="mx-4 mt-6 bg-white rounded-2xl shadow p-5">
    <h3 class="text-lg font-bold text-gray-800 mb-4">عنوان العميل</h3>

    <label class="flex items-center gap-3 cursor-pointer">
        <input type="radio" name="address" checked class="w-5 h-5">
        <span class="text-gray-700 text-sm">
            {{ user.profile.address|default:"المنزل — لم يتم تحديد عنوان" }}
        </span>
    </label>
</div>

<!-- ================= PAYMENT METHOD ================= -->
<div class="mx-4 mt-6 bg-white rounded-2xl shadow p-5">
    <h3 class="text-lg font-bold text-gray-800 mb-4">طريقة الدفع</h3>

    <!-- Cash -->
    <label class="flex items-center justify-between py-3 border-b cursor-pointer">
        <div class="flex items-center gap-3">
            <input type="radio" name="payment" checked class="w-5 h-5"
                   onclick="showCardForm('cash')">
            <span class="text-gray-700">تحويل بنكي / دفع يدوي</span>
        </div>
        <span class="text-sm text-gray-500">بدون رسوم</span>
    </label>

    <!-- Card -->
    <label class="flex items-center justify-between py-3 border-b cursor-pointer">
        <div class="flex items-center gap-3">
            <input type="radio" name="payment" class="w-5 h-5"
                   onclick="showCardForm('card')">
            <span class="text-gray-700">بطاقة (مدى / فيزا / ماستر)</span>
        </div>
        <span class="text-sm text-gray-500">+2%</span>
    </label>

    <!-- Card Form -->
    <div id="cardForm" class="hidden mt-4 bg-gray-50 p-4 rounded-xl border">

        <label class="block mb-2 text-gray-700 text-sm">رقم البطاقة</label>
        <input type="text" maxlength="19"
               class="w-full border rounded-lg px-3 py-2 mb-4 focus:outline-none focus:border-primary"
               placeholder="1234 5678 9012 3456"
               oninput="formatCardNumber(this)">

        <div class="flex gap-3">
            <div class="flex-1">
                <label class="block mb-2 text-gray-700 text-sm">تاريخ الانتهاء</label>
                <input type="text" maxlength="5"
                       class="w-full border rounded-lg px-3 py-2 mb-4 focus:outline-none focus:border-primary"
                       placeholder="MM/YY"
                       oninput="formatExpire(this)">
            </div>

            <div class="w-24">
                <label class="block mb-2 text-gray-700 text-sm">CVV</label>
                <input type="text" maxlength="4"
                       class="w-full border rounded-lg px-3 py-2 mb-4 focus:outline-none focus:border-primary"
                       placeholder="123">
            </div>
        </div>

        <label class="flex items-center gap-2 text-sm text-gray-700">
            <input type="checkbox" class="w-4 h-4">
            حفظ البطاقة
        </label>
    </div>
</div>

<!-- ================= SUMMARY ================= -->
<div class="mx-4 mt-6 bg-white rounded-2xl shadow p-5">
    <h3 class="text-lg font-bold text-gray-800 mb-4">ملخص الطلب</h3>

    <div class="flex justify-between text-gray-700 mb-2">
        <span>قيمة الخدمة</span>
        <span>{{ amount }} ريال</span>
    </div>

    <div class="flex justify-between text-gray-900 font-bold text-lg border-t pt-3 mt-3">
        <span>الإجمالي</span>
        <span>{{ amount }} ريال</span>
    </div>
</div>

<!-- ================= CONFIRM ================= -->
<div class="mx-4 mt-6">
    <form method="post" action="{% url 'confirm_payment' %}">
        {% csrf_token %}
        <button type="submit"
                class="w-full bg-primary hover:bg-green-700 text-white font-bold py-3 rounded-xl text-lg shadow-lg">
            تأكيد الدفع
        </button>
    </form>
</div>

<!-- ================= SCRIPTS ================= -->
<script>
    function showCardForm(option) {
        const cardForm = document.getElementById("cardForm");
        option === 'card'
            ? cardForm.classList.remove("hidden")
            : cardForm.classList.add("hidden");
    }

    function formatCardNumber(input) {
        let value = input.value.replace(/\D/g, '');
        input.value = value.replace(/(.{4})/g, '$1 ').trim();
    }

    function formatExpire(input) {
        let value = input.value.replace(/\D/g, '');
        if (value.length > 2) {
            value = value.slice(0,2) + '/' + value.slice(2,4);
        }
        input.value = value;
    }
</script>

</body>
</html>
